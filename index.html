<!DOCTYPE html>
<html lang="fi">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <style>
      body {
        background-color: black;
        overflow: hidden;
      }
    </style>
    <script type="module">
      import kaboom from 'https://unpkg.com/kaboom/dist/kaboom.mjs';

      kaboom({
        global: true,
        fullscreen: true,
        scale: 2,
        debug: true,
        background: [51, 151, 255], // RGB
      });

      // Pelaajan asetukset
      let playerMoveSpeed = 150;
      let playerJumpForce = 550;
      let playerPoints = 0;

      // Alat
      let scopeA = 0; 
      let scopeB = 0;
      let scopeC = 0;
      let scopeD = 0;
      let scopeE = 0;
      let scopeF = 0;
      let scopeG = 0;
      let scopeH = 0;

      // Kysymys tekstit
      let kysymys1 = true;


      loadSprite('logo', 'Kuvat/keuda_logo.png');
      loadSprite('bg', 'Kuvat/tausta.png');
      loadSprite('ground', 'Kuvat/tausta_alareuna.png');
      loadSprite('mario', 'Kuvat/hahmo.png');
      loadSprite('spider', 'Kuvat/örkki.png');
      loadSprite('block', 'Kuvat/block.png');
      loadSprite('suprise', 'Kuvat/block_kysymys.png');
      // loadSprite('coin', 'Kuvat/coin.png');
      loadSprite('empty', 'Kuvat/block_tyhjä.png');
      // loadSprite('cloud', 'Kuvat/pilvi.png');
      
      add([sprite('bg', { width: width(), height: height() }), pos(0, 0), fixed()]);
      add([sprite('ground', { width: 2000, height: 150 }), pos(0, 500), fixed()]);
      add([sprite('logo', { width: 150, height: 50 }), pos(0, 580), fixed()]);

      let player = add([
        sprite('mario'), 
        solid(), 
        pos(50, 0), 
        body(), 
        area(), 
        scale(0.7)
      ]);

      let levels = [
        [
          '£                                                     £',
          '£                                                     £',
          '£                                                     £',
          '£                                                     £',
          '£                               %  %   %              £',
          '£                                                     £',
          '£                                                     £',
          '£                                                     £',
          '£                              ==========          -+ £',
          '£               ==    #  ==   ============    #    () £',
          '=======================================================',
        ],
        [
          '£                               *                                       £',
          '£                                                                       £',
          '£                                                                       £',
          '£                                                                       £',
          '£                              x                %                       £',
          '£        ===%%=              x x                                        £',
          '£                          x x x                                        £',
          '£                        x x x x  x             x                     -+£',
          '£               ^   ^  x x x x x  x            x                      ()£',
          '=========================================  ===============  =============',
        ],
        [
          '£                                                                       £',
          '£                              %                                        £',
          '£          *                                                            £',
          '£                                                                       £',
          '£                                                                       £',
          '£        @%@%%@              x x                                        £',
          '£                          x x x                                        £',
          '£                        x x x x  x               x                   -+£',
          '£           #    ^   ^  x x x x x  x               x           x      ()£',
          '=========================================  ===============  =============',
        ],
      ];

      let level1 = addLevel(levels[0], {
        width: 20,
        height: 20,
        '=': () => [sprite('block'), solid(), area(), scale(0.44), ''],
        '£': () => [sprite('block'), solid(), area(), scale(0.44), ''],

        '%': () => [sprite('suprise'), solid(), area(), scale(0.4), 'Suprise'],

        // '*': () => [sprite('cloud'), scale(0.3), layer('bg'), 'Pilvi'],

        '#': () => [sprite('spider'), solid(), area(), scale(1), 'Spider'],
        
        // '$': () => [sprite('coin'), solid(), area(), scale(1), 'Coin'],

        '¤': () => [sprite('empty'), solid(), area(), scale(1),  'Empty'],
      });

      // player.onCollide('Suprise', (Suprise) => {
      //   let x = Suprise.pos.x;
      //   let y = Suprise.pos.y;
      //   destroy(Suprise);
      //   onUpdate()
      //   // add([pos(x, y - 18), sprite('coin'), area(), body()]);
      //   add([pos(x, y), sprite('empty'), area(), solid(), scale(0.4)]);
      // });

      // player.onCollide('Coin', (Coin) => {
      //   destroy(Coin);
      // })
      if(kysymys1 == true)
      {
        // Ykkös kysymys
        add([
          text('Pidatko elaimista?'),
          pos(640, 40),
          scale(0.20),
        ])

        // Ykkös vastaukset
        add([
          text('En'),
          pos(643, 70),
          scale(0.14),
        ])

        add([
          text('Vahan'),
          pos(695, 70),
          scale(0.14),
        ])

        add([
          text('Kylla'),
          pos(775, 70),
          scale(0.14),
        ])

        player.onCollide('Suprise', (s) => {
          let x = s.pos.x;
          let y = s.pos.y;
          destroyAll('Suprise')
          add([pos(x, y), sprite('empty'), area(), solid(), scale(0.4)]);
        })
      }

      // "Örkki" moves
      onUpdate('Spider', (Spider) => {
        Spider.move(-15, 0);
      });

      // If player touches "Örkki" then screen will shake
      player.onCollide('Spider', (Spider) => {
        shake(5);
      });

      // TODO: Make sure camera keeps following player
      player.onUpdate(() => {
        camPos(player.pos);
      });

      // TODO: Movement
      onKeyDown('left', () => {
        player.move(-playerMoveSpeed, 0);
        camPos(player.pos);
        player.flipX(true);
      });

      onKeyDown('right', () => {
        player.move(playerMoveSpeed, 0);
        camPos(player.pos);
        player.flipX(false);
      });

      // TODO: Jump
      onKeyPress('space', () => {
        if (player.isGrounded()) {
          player.jump(playerJumpForce, 0);
        }
      });

      onKeyPress('up', () => {
        if (player.isGrounded()) {
          player.jump(playerJumpForce, 0);
        }
      });
    </script>
  </body>
</html>
