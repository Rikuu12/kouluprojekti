<!DOCTYPE html>
<html lang="fi">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <div style="display: grid; height: 100vh; width: 100vw" class="puhelin">
            <h1 id="puhelin">Käännä puhelin</h1>
        </div>

        <style>
            * {
                margin: 0;
                padding: 0;
            }
            body {
                background-color: black;
                overflow: hidden;
            }

            .puhelin {
                position: absolute;
            }

            h1 {
                color: white;
                position: absolute;
                display: none;
                place-self: center;

            }
        </style>

        <script type="module">
            import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";

            window.mobileCheck = function () {
                let check = false;
                (function (a) {
                    if (
                        /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(
                            a
                        ) ||
                        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(
                            a.substr(0, 4)
                        )
                    )
                        check = true;
                })(navigator.userAgent || navigator.vendor || window.opera);
                return check;
            };

            const mobile = window.mobileCheck();

            function timeout(ms) {
                return new Promise((resolve) => setTimeout(resolve, ms));
            }

            let lsm = false;

            async function checkOR() {
                if (screen.orientation.type == "landscape-primary" ||screen.orientation.type == "landscape-secondary") {
                    lsm = true;
                    document.getElementById("puhelin").style.display = "none";
                } else {
                    document.getElementById("puhelin").style.display = "block";
                }
            }
            
            if (mobile) {
                
                while (!lsm) {
                    checkOR();
                    await timeout(200);
                }

                kaboom({
                    global: true,
                    fullscreen: true,
                    scale: 1.3,
                    debug: true,
                    background: [51, 151, 255],
                });
            } else {
                kaboom({
                    global: true,
                    fullscreen: true,
                    scale: 2.5,
                    debug: true,
                    background: [51, 151, 255],
                });
            }

            let playerMoveSpeed = 150;
            let playerJumpForce = 250;
            let playerPoints = 0;

            let scopeA = 0;
            let scopeB = 0;
            let scopeC = 0;
            let scopeD = 0;
            let scopeE = 0;
            let scopeF = 0;
            let scopeG = 0;
            let scopeH = 0;

            loadSprite("logo", "Kuvat/keuda_logo.png");
            loadSprite("bg", "Kuvat/tausta.png");
            loadSprite("ground", "Kuvat/tausta_alareuna.png");
            loadSprite("mario", "Kuvat/hahmo.png");
            loadSprite("mariojumpoff", "Kuvat/hahmo_aloitus_tippuminen.png");
            loadSprite("suprise", "Kuvat/block_kysymys.png");
            loadSprite("spider", "Kuvat/örkki.png");
            loadSprite("block", "Kuvat/block.png");
            loadSprite("tunnel", "Kuvat/ampari.png");
            loadSprite("arrow", "Kuvat/nuoli.png");
            loadSprite("reminder", "Kuvat/teksti_nuoli.png");
            loadSprite("flagfinish", "Kuvat/maali_tausta_levelille.png");
            loadSprite("start", "Kuvat/start.png");
            loadSprite("aloitus1", "Kuvat/aloitus otsikko_ala.png");
            loadSprite("aloitus2", "Kuvat/aloitus otsikko_alin.png");
            loadSprite("aloitus3", "Kuvat/aloitus_otsikko.png");

            loadSound("hyppy", "./hyppy.mp3"); // Hyppy

            let levels = [
                [
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                                    £",
                    "£                  (                 £",
                    "£                                    £",
                    "======================================",
                ],
                [
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                                                   £",
                    "£                         %  %  %             -     £",
                    "£                                                   £",
                    "£             %  %  %                 %  %  %     ^ £",
                    "£                                                   £",
                    "£                        =========                + £",
                    "£                       ===========                 £",
                    "=====================================================",
                ],
                [
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                 =====                                 £",
                    "£                    ==      ==            ======                       £",
                    "£                                                    ===========        £",
                    "£                                                                       £",
                    "£                                                                  -    £",
                    "£            %  %  %       ==  %  %  %  ==       %  %  %              ^ £",
                    "£                                                                       £",
                    "£                                                                     + £",
                    "£                #                                          #           £",
                    "=========================================================================",
                ],
                [
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                                                       £",
                    "£                                               #                       £",
                    "£                                          ======                       £",
                    "£              =======          ==                                   !  £",
                    "£                                               #                       £",
                    "£                                          ======                       £",
                    "£            %  %  %       ==  %  %  %                             -    £",
                    "£                                                                     ^ £",
                    "£                                                                     + £",
                    "£                #                                          #           £",
                    "=========================================================================",
                ],
            ];
            //Aloitusruutu
            scene("aloitusLevel", () => {
                debug.log("aloituslevel ");

                add([sprite("bg", { width: width(), height: height() }), pos(0, 0), fixed()]);
                add([sprite("ground", { width: screen.width, height: screen.height }), pos(0, 250), fixed()]);
                // add([sprite('logo', { width: 150, height: 50 }), pos(0, 580), fixed()]);

                let player = add([sprite("mario"), solid(), pos(370, 380), body(), area(), scale(0.7)]);

                addLevel(levels[0], {
                    width: 20,
                    height: 20,
                    "=": () => [sprite("block"), solid(), area(), scale(0.44), ""],
                    "£": () => [sprite("block"), solid(), area(), scale(0.44), ""],
                    "+": () => [sprite("tunnel"), solid(), area(), scale(0.5), "Tunnel"],
                    "^": () => [sprite("arrow"), scale(0.4), "Arrow"],
                    "#": () => [sprite("spider"), solid(), area(), scale(1), "Spider"],
                    "%": () => [sprite("suprise"), solid(), area(), scale(0.4), "Suprise"],
                    "-": () => [sprite("reminder"), area(), scale(0.2), "Reminder"],
                    "(": () => [sprite("start"), area(), scale(0.5), origin("center"), "Start"],
                });

                add([
                    pos(380, 290),
                    // Render text with the text() component
                    sprite("aloitus3"),
                    origin("center"),
                ]);
                add([
                    pos(380, 310),
                    // Render text with the text() component
                    sprite("aloitus1"),
                    origin("center"),
                ]);
                add([
                    pos(380, 330),
                    // Render text with the text() component
                    sprite("aloitus2"),
                    origin("center"),
                ]);

                player.onCollide("Start", (Start) => {
                    go("firstLevel");
                });

                gravity(660);

                onUpdate("Spider", (Spider) => {
                    Spider.move(-15, 0);
                });

                player.onCollide("Spider", (Spider) => {
                    shake(10);
                });

                player.onUpdate(() => {
                    camPos(player.pos);
                });

                onKeyDown("left", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                onKeyDown("right", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                onKeyPress("space", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                    }
                });

                onKeyPress("up", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                    }
                });
            });

            // LEVEL: 1
            scene("firstLevel", () => {
                debug.log("TASO 1");

                add([sprite("bg", { width: width(), height: height() }), pos(0, 0), fixed()]);
                add([sprite("ground", { width: screen.width, height: screen.height }), pos(0, 250), fixed()]);
                // add([sprite('logo', { width: 150, height: 50 }), pos(0, 580), fixed()]);

                let player = add([sprite("mario"), solid(), pos(140, 360), body(), area(), scale(0.7)]);

                addLevel(levels[0], {
                    width: 20,
                    height: 20,
                    "=": () => [sprite("block"), solid(), area(), scale(0.44), ""],
                    "£": () => [sprite("block"), solid(), area(), scale(0.44), ""],
                    "+": () => [sprite("tunnel"), solid(), area(), scale(0.5), "Tunnel"],
                    "^": () => [sprite("arrow"), scale(0.5), "Arrow"],
                    "#": () => [sprite("spider"), solid(), area(), scale(1), "Spider"],
                    "%": () => [sprite("suprise"), solid(), area(), scale(0.4), "Suprise"],
                    "-": () => [sprite("reminder"), area(), scale(0.25), "Reminder"],
                });

                //--------------------------------------------------------------------
                add([text("TASO 1"), pos(125, 350), scale(0.2)]);

                // 1
                add([text("Kysymys 1"), pos(278, 310), scale(0.2)]);

                add([text("Kylla"), pos(275, 365), scale(0.14)]);
                add([text("Vahan"), pos(335, 365), scale(0.14)]);
                add([text("En"), pos(403, 365), scale(0.14)]);

                /// 2
                add([text("Kysymys 2"), pos(510, 275), scale(0.2)]);

                add([text("Kylla"), pos(516, 325), scale(0.14)]);
                add([text("Vahan"), pos(574, 325), scale(0.14)]);
                add([text("En"), pos(642, 325), scale(0.14)]);

                // 3
                add([text("Kysymys 3"), pos(760, 310), scale(0.2)]);

                add([text("Kylla"), pos(754, 365), scale(0.14)]);
                add([text("Vahan"), pos(815, 365), scale(0.14)]);
                add([text("En"), pos(882, 365), scale(0.14)]);

                //--------------------------------------------------------------------
                player.onCollide("Tunnel", (Tunnel) => {
                    go("secondLevel");
                });

                gravity(660);

                onUpdate("Spider", (Spider) => {
                    Spider.move(-15, 0);
                });

                player.onCollide("Spider", (Spider) => {
                    shake(10);
                });

                player.onUpdate(() => {
                    camPos(player.pos);
                });

                //-------------------------------------------------------------------------
                onKeyDown("left", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                onKeyDown("a", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                //-------------------------------------------------------------------------
                onKeyDown("right", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                onKeyDown("d", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                //-------------------------------------------------------------------------
                onKeyPress("space", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                        const jumpSound = play("hyppy", {
                            volume: 0.5,
                            loop: false,
                        });
                    }
                });

                onKeyPress("up", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                        const jumpSound = play("hyppy", {
                            volume: 0.5,
                            loop: false,
                        });
                    }
                });

                onKeyPress("w", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                    }
                });
            });

            // LEVEL: 2
            scene("secondLevel", () => {
                debug.log("TASO 2");

                add([sprite("bg", { width: width(), height: height() }), pos(0, 0), fixed()]);
                add([sprite("ground", { width: screen.width, height: screen.height }), pos(0, 250), fixed()]);

                // add([sprite('logo', { width: 150, height: 50 }), pos(0, 580), fixed()]);
                let player = add([sprite("mario"), solid(), pos(140, 250), body(), area(), scale(0.7)]);

                // let player = add([sprite('mariojumpoff'), solid(), pos(140, 160), body(), area(), scale(0.8)]);

                gravity(660);

                addLevel(levels[1], {
                    width: 20,
                    height: 20,
                    "=": () => [sprite("block"), solid(), area(), scale(0.44), "Block"],
                    "£": () => [sprite("block"), solid(), area(), scale(0.44), "Wall"],
                    "+": () => [sprite("tunnel"), solid(), area(), scale(0.5), "Tunnel"],
                    "^": () => [sprite("arrow"), scale(0.4), "Arrow"],
                    "#": () => [sprite("spider"), solid(), area(), scale(1), "Spider"],
                    "%": () => [sprite("suprise"), solid(), area(), scale(0.4), "Suprise"],
                    "-": () => [sprite("reminder"), area(), scale(0.2), "Reminder"],
                });

                //--------------------------------------------------------------------
                add([text("TASO 2"), pos(125, 275), scale(0.2)]);

                // 1
                add([text("Kysymys 4"), pos(260, 230), scale(0.2)]);

                add([text("Kylla"), pos(255, 286), scale(0.14)]);
                add([text("Vahan"), pos(314, 286), scale(0.14)]);
                add([text("En"), pos(382, 286), scale(0.14)]);

                /// 2
                add([text("Kysymys 5"), pos(620, 230), scale(0.2)]);

                add([text("Kylla"), pos(610, 286), scale(0.14)]);
                add([text("Vahan"), pos(675, 286), scale(0.14)]);
                add([text("En"), pos(740, 286), scale(0.14)]);

                // 3
                add([text("Kysymys 6"), pos(980, 230), scale(0.2)]);

                add([text("Kylla"), pos(975, 286), scale(0.14)]);
                add([text("Vahan"), pos(1035, 286), scale(0.14)]);
                add([text("En"), pos(1103, 286), scale(0.14)]);

                //--------------------------------------------------------------------

                player.onCollide("Tunnel", (Tunnel) => {
                    go("thirdLevel");
                });

                onUpdate("Spider", (Spider) => {
                    Spider.move(-15, 0);
                });

                player.onCollide("Spider", (Spider) => {
                    shake(10);
                });

                player.onUpdate(() => {
                    camPos(player.pos);
                });

                //-------------------------------------------------------------------------
                onKeyDown("left", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                onKeyDown("a", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                //-------------------------------------------------------------------------
                onKeyDown("right", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                onKeyDown("d", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                //-------------------------------------------------------------------------
                onKeyPress("space", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                        const jumpSound = play("hyppy", {
                            volume: 0.5,
                            loop: false,
                        });
                    }
                });

                onKeyPress("up", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                        const jumpSound = play("hyppy", {
                            volume: 0.5,
                            loop: false,
                        });
                    }
                });

                onKeyPress("w", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                    }
                });
            });

            // LEVEL: 3
            scene("thirdLevel", () => {
                debug.log("TASO 3");

                add([sprite("bg", { width: width(), height: height() }), pos(0, 0), fixed()]);
                add([sprite("ground", { width: screen.width, height: screen.height }), pos(0, 250), fixed()]);
                // add([sprite('logo', { width: 150, height: 50 }), pos(0, 580), fixed()]);

                let player = add([sprite("mario"), solid(), pos(140, 160), body(), area(), scale(0.7)]);

                gravity(660);

                addLevel(levels[2], {
                    width: 20,
                    height: 20,
                    "=": () => [sprite("block"), solid(), area(), scale(0.44), ""],
                    "£": () => [sprite("block"), solid(), area(), scale(0.44), ""],
                    "+": () => [sprite("tunnel"), solid(), area(), scale(0.5), "Tunnel"],
                    "^": () => [sprite("arrow"), scale(0.4), "Arrow"],
                    "#": () => [sprite("spider"), solid(), area(), scale(1), "Spider"],
                    "*": () => [sprite("arrow"), solid(), area(), scale(0.5), "Death"],
                    "%": () => [sprite("suprise"), solid(), area(), scale(0.4), "Suprise"],
                    "-": () => [sprite("reminder"), area(), scale(0.2), "Reminder"],
                    "!": () => [sprite("flagfinish"), solid(), area(), scale(0.5), "flagfinish"],
                });

                //--------------------------------------------------------------------
                add([text("TASO 3"), pos(125, 280), scale(0.2)]);

                // 1
                add([text("Kysymys 7"), pos(260, 230), scale(0.2)]);

                add([text("Kylla"), pos(255, 286), scale(0.14)]);
                add([text("Vahan"), pos(314, 286), scale(0.14)]);
                add([text("En"), pos(382, 286), scale(0.14)]);

                /// 2
                add([text("Kysymys 8"), pos(620, 230), scale(0.2)]);

                add([text("Kylla"), pos(610, 286), scale(0.14)]);
                add([text("Vahan"), pos(675, 286), scale(0.14)]);
                add([text("En"), pos(740, 286), scale(0.14)]);

                //--------------------------------------------------------------------

                player.onCollide("Tunnel", (Tunnel) => {
                    go("firstLevel");
                });

                player.onCollide("Death", (Death) => {
                    shake(50);
                    go("thirdLevel");
                });

                onUpdate("Spider", (Spider) => {
                    Spider.move(-15, 0);
                });

                player.onCollide("Spider", (Spider) => {
                    shake(10);
                });

                player.onUpdate(() => {
                    camPos(player.pos);
                });

                //-------------------------------------------------------------------------
                onKeyDown("left", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                onKeyDown("a", () => {
                    player.move(-playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(true);
                });

                //-------------------------------------------------------------------------
                onKeyDown("right", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                onKeyDown("d", () => {
                    player.move(playerMoveSpeed, 0);
                    camPos(player.pos);
                    player.flipX(false);
                });

                //-------------------------------------------------------------------------
                onKeyPress("space", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                        const jumpSound = play("hyppy", {
                            volume: 0.5,
                            loop: false,
                        });
                    }
                });

                onKeyPress("up", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                        const jumpSound = play("hyppy", {
                            volume: 0.5,
                            loop: false,
                        });
                    }
                });

                onKeyPress("w", () => {
                    if (player.isGrounded()) {
                        player.jump(playerJumpForce, 0);
                    }
                });
            });

            onLoad(() => {
                go("aloitusLevel");
            });
        </script>
    </body>
</html>
